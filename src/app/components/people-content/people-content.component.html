<div class="container" *ngIf="narrator$ | async as narrator">
  <div class="titles">
    <h1 class="arabic">{{narrator.titles.ar}}</h1>
  </div>

  <!-- Narrated Ahadith Section -->
  <section class="narrated-section">
    <h2>Narrated Ahadith</h2>

    <div class="search-box">
      <mat-form-field appearance="outline" class="w-full">
        <mat-label>Search Ahadith</mat-label>
        <input matInput (keyup)="applyFilter($event, versePathsDataSource)" placeholder="Search by path...">
        <mat-icon matSuffix>search</mat-icon>
      </mat-form-field>
    </div>

    <button mat-button (click)="sortVersePathsByLength()">Sort by Length</button>

    <cdk-virtual-scroll-viewport #versePathsViewport itemSize="50" class="viewport">
      <mat-table [dataSource]="versePathsDataSource">
        <ng-container matColumnDef="path">
          <mat-cell *matCellDef="let element">
            <div class="path-cell"><app-path-link [path]="element.path"></app-path-link></div>
          </mat-cell>
        </ng-container>

        <mat-row *matRowDef="let row; columns: displayedColumnsPaths;"></mat-row>
      </mat-table>
    </cdk-virtual-scroll-viewport>
  </section>

  <!-- Co-Narrators Section -->
  <section class="conarrators-section">
    <h2>Co-Narrators</h2>

    <div class="search-box">
      <mat-form-field appearance="outline" class="w-full">
        <mat-label>Search Co-Narrators</mat-label>
        <input matInput (keyup)="applyFilter($event, subchainsDataSource)" placeholder="Search narrators...">
        <mat-icon matSuffix>search</mat-icon>
      </mat-form-field>
    </div>

    <cdk-virtual-scroll-viewport #subchainsViewport itemSize="50" class="viewport" (scrolledIndexChange)="onScroll()">
      <mat-table [dataSource]="subchainsDataSource">
        <ng-container matColumnDef="subchain">
          <mat-cell *matCellDef="let element">
            <div class="subchain-container">
              <div class="subchain-text arabic" dir="rtl">
                <ng-container *ngFor="let narrator_id of element.value.narrator_ids; let isLast = last">
                  <a [routerLink]="['/people/narrators/' + narrator_id]" class="narrator-link">
                    {{(narratorIndex$ | async)?.[narrator_id]?.titles?.ar || narrator_id}}
                  </a>
                  <span *ngIf="!isLast" class="arrow">‚üµ</span>
                </ng-container>
              </div>
              <div class="verse-count" *ngIf="element.value.verse_paths">
                ({{element.value.verse_paths.length}} verses)
              </div>
              <ol>
                <li *ngFor="let path of element.value.verse_paths">
                  <app-path-link [path]="path"></app-path-link>
                </li>
              </ol>
            </div>
          </mat-cell>
        </ng-container>

        <mat-row *matRowDef="let row; columns: displayedColumnsSubchains;"></mat-row>
      </mat-table>
    </cdk-virtual-scroll-viewport>

    <!-- Pagination Controls -->
    <mat-paginator
      [length]="subchainsDataSource.data.length"
      [pageSize]="pageSize"
      [pageSizeOptions]="[10, 25, 50, 100]"
      (page)="loadNextPage()"
      aria-label="Select page">
    </mat-paginator>
  </section>
</div>

<!-- Loading Spinner -->
<div class="loading-container" *ngIf="!(narrator$ | async)">
  <mat-spinner></mat-spinner>
</div>
